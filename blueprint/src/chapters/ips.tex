\chapter{The inner product for the multi-matrix algebra}
 \section{On $M_n$}

  \begin{definition}\label{Dual.matrix}\lean{Module.Dual.matrix}\leanok
   Given a linear functional $\phi\colon M_n \to \CC$, we define $\phi_Q=\sum_{i,j}\phi(e_{ij})e_{ji}$.
  \end{definition}

  \begin{lemma}\label{dual_eq_trace}\uses{Dual.matrix}\lean{Module.Dual.apply}\leanok
   Given a linear functional $\phi\colon M_n\to\CC$, we get $\phi$ is given by $x\mapsto\Tr(\phi_Q \,x)$.
  \end{lemma}
  \begin{proof}\leanok
   Straightforward computation.
  \end{proof}

  \begin{definition}\label{LinearMap.IsPosMap}\lean{LinearMap.IsPosMap}\leanok
   Given C$^*$-algebras $A,C$, we say a linear map $f\colon A \to C$ is \textit{positive} when $0\leq f(a)$ for all $0\leq a$. In other words, $f$ maps positive elements in $A$ to positive elements in $C$.
  \end{definition}

  As any matrix $x\in{M_n}$ is positive if and only if there exists some $y\in M_n$ such that $x=y^*y$, we get that a linear functional $f$ on $M_n$ is a \textit{positive map} when $0\leq{f(x^*x)}$ for any matrix $x\in{M_n}$.

  \begin{lemma}\label{Dual.isPosMap_iff_of_matrix}\uses{Dual.matrix, LinearMap.IsPosMap}\lean{Module.Dual.isPosMap_iff_of_matrix}\leanok
   Given a linear functional $\phi$ on $M_n$, we have,\\
   \hspace*{0.5cm}$\phi$ is positive $\,\LRa\,$ $0\leq\phi_Q$.\\
   Here, $\phi_Q$ is the matrix of $\phi$ defined in Definition \ref{Dual.matrix}.
  \end{lemma}
  \begin{proof}\uses{dual_eq_trace, LinearMap.isPositive_iff_eq_sum_rankOne}\leanok
   By Lemma \ref{dual_eq_trace} we have $\phi(x)=\Tr(\phi_Q\, x)$ for all $x\in{M_n}$.
   \begin{description}
    \item[$(\tto)$]
     Suppose $\phi$ is positive. By Lemma \ref{LinearMap.isPositive_iff_eq_sum_rankOne}, we get $0\leq\sum_i\phi(x_ix_i^*)$ for any tuple $(x_i)$ in $\CC^n$. So then for any $x\in\CC^n$, we have $0\leq\phi(xx^*)=\Tr(\phi_Q\, xx^*)=x^*\phi_Q\, x$, which means $\phi_Q$ is positive semi-definite.
    \item[$(\ott)$]
     Suppose $\phi_Q$ is positive semi-definite. Then since $\phi_Q$ is positive semi-definite, we have $\phi_Q=\phi_Q^{1/2}\phi_Q^{1/2}$, where $\phi_Q^{1/2}$ is also positive semi-definite (and so is self-adjoint). So for any $x\in{M_n}$, we have $\phi(x^*x)=\Tr(\phi_Q\, x^*x)=\Tr\left({(x\phi_Q^{1/2})}^*(x\phi_Q^{1/2})\right)\geq0$.
   \end{description}
   Thus $\phi$ is a positive map if and only if our matrix $\phi_Q$ is positive semi-definite.
  \end{proof}

  \begin{proposition}\label{Dual.isReal_iff}\uses{LinearMap.IsReal, Dual.matrix}\lean{Module.Dual.isReal_iff}\leanok
   Given a linear functional $\phi\colon{M_n}\to\CC$, we get $\phi$ is real (star-preserving) if and only if $\phi_Q$ is self-adjoint.\\
   Here, $\phi_Q$ is the matrix given by $\phi$ defined in Definition \ref{Dual.matrix}.
  \end{proposition}
  \begin{proof}\uses{dual_eq_trace}\leanok {\ }
   \begin{description}
    \item[$(\tto)$]
     Suppose $\phi$ is star-preserving, i.e., $\phi(x^*)=\overline{\phi(x)}$ for all $x\in{M_n}$.
     We let $x\in{M_n}$, and compute using Lemma \ref{dual_eq_trace},
     \[\Tr(\phi_Q\, x^*)=\phi(x^*)=\overline{\phi(x)}=\overline{\Tr(\phi_Q\, x)}=\Tr(x^*\phi_Q^*),\]
     And so $\phi_Q=\phi_Q^*$.
    \item[$(\ott)$]
     Suppose $\phi_Q$ is self-adjoint. Using Lemma \ref{dual_eq_trace}, $\phi$ is given by $x\mapsto\Tr(\phi_Q\, x)$.
     And so for any $x\in{M_n}$, we get $\phi(x^*)=\Tr(\phi_Q\, x^*)=\Tr({(x\phi_Q)}^*)=\overline{\Tr(x\phi_Q)}=\overline{\phi(x)}$.
     Thus, $\phi$ is real.
   \end{description}
  \end{proof}

\begin{corollary}\label{Matrix.isPosSemidef_and_invertible_iff_isPosDef}\lean{Matrix.PosSemidef.invertible_iff_posDef}\leanok
  If $A\in{M_n}$. Then\\
  \hspace*{0.5cm}$0\leq{A}$ and is invertible $\,\LRa\,$ $A$ is positive-definite.
 \end{corollary}
 \begin{proof}\leanok {\ }
  \begin{description}
   \item[$(\tto)$]
    Suppose $0\leq{A}$ and $A=A^{1/2}A^{1/2}$ is invertible. Then $A^{1/2}$ is also invertible and positive semi-definite. Let $v\in\CC^n$ be non-zero.
    Then, we compute,
    \[\ip{v}{Av}=\ip{v}{A^{1/2}A^{1/2}v}=\ip{A^{1/2}v}{A^{1/2}v}>0,\]
    since $A^{1/2}v\neq0$ (as $A^{1/2}$ is invertible). Note that, in the second equality, we use the self-adjointed-ness of $A^{1/2}$ since it is positive semi-definite. So we are done.
   \item[$(\ott)$]
    Suppose $0<A$. Then obviously $0\leq{A}$, so we only need to check if it is invertible. Suppose the contrary, i.e., $A$ is not invertible. Then there exists a non-zero $v\in\CC^n$ such that $Av=0$. But then, by the hypothesis, we get $0<\ip{v}{Av}=0$, which is a contradiction. Thus $A$ is invertible.
  \end{description}
 \end{proof}


\begin{lemma}\label{PosDef.trace_conjTranspose_mul_self_eq_zero_iff}\lean{Matrix.PosDef.trace_conjTranspose_hMul_self_eq_zero}\leanok
  Given a positive definite matrix $Q\in{M_n}$, we have $\Tr(Qx^*x)=0$ if and only if $x=0$ for any $x\in{M_n}$.
 \end{lemma}
 \begin{proof}\uses{Matrix.isPosSemidef_and_invertible_iff_isPosDef}\leanok
  We have $\Tr\left({(xQ^{1/2})}^*(xQ^{1/2})\right)=\Tr(Qx^*x)=0$ if and only if $xQ^{1/2}=0$. As $Q^{1/2}$ is positive definite, we get it is also invertible by Corollary \ref{Matrix.isPosSemidef_and_invertible_iff_isPosDef}, and so $xQ^{1/2}=0$ if and only if $x=0$. And so we are done.
 \end{proof}

  \begin{definition}\label{Dual.IsFaithful}\lean{Module.Dual.IsFaithful}\leanok
   A linear functional $f$ on $A$ is said to be \textit{faithful} if $f(x^*x)=0$ if and only if $x=0$ for all $x\in A$.
  \end{definition}

  \begin{proposition}\label{Dual.isFaithfulPosMap_iff}
    \uses{LinearMap.IsPosMap, Dual.IsFaithful, Dual.matrix}
    \lean{Module.Dual.isFaithfulPosMap_iff_of_matrix}\leanok
    Given a linear functional $\phi\colon{M_n}\to\CC$, we have\\
    \hspace*{0.5cm}$\phi$ is a positive and faithful map $\,\LRa\,$ $\phi_Q$ is positive-definite.\\
    Again, $\phi_Q$ is the matrix given by $\phi$ defined in Definition \ref{Dual.matrix}.
   \end{proposition}
   \begin{proof}\uses{dual_eq_trace, Dual.isPosMap_iff_of_matrix, PosDef.trace_conjTranspose_mul_self_eq_zero_iff}\leanok
    By Lemma \ref{dual_eq_trace}, we have $\phi$ is given by $x\mapsto\Tr(\phi_Q\, x)$, and by Lemma \ref{Dual.isPosMap_iff_of_matrix}, we know $\phi$ is positive if and only if $0\leq\phi_Q$.
    So we need to show that faithfulness of a positive linear functional is equivalent to $\phi_Q$ being positive definite.
    \begin{description}
     \item[$(\tto)$]
      Suppose $\phi$ is faithful and positive.
      So we have $\phi(x)=0$ if and only if $x=0$ for any positive semi-definite matrix $x\in{M_n}$.
      Let $0\neq{x}\in\CC^n$. Then we have $xx^*\neq0$ as $x\neq0$. This means, by faithfulness and positivity of $\phi$ we get $\phi(xx^*)\neq0$ as $xx^*$ is a non-zero positive semi-definite matrix. And so $0<\phi(xx^*)=\Tr(\phi_Q\, xx^*)=x^*\phi_Q\, x$, which means $\phi_Q$ is positive definite.
     \item[$(\ott)$]
      Suppose $\phi_Q$ is positive definite. Then for any $x\in{M_n}$, we get $\phi(x^*x)=\Tr(\phi_Q\, xx^*)=0$ if and only if $x=0$ using Lemma \ref{PosDef.trace_conjTranspose_mul_self_eq_zero_iff}.
    \end{description}
    Thus $\phi$ is a faithful and positive linear functional if and only if the matrix $\phi_Q$ is positive definite.
   \end{proof}

  \begin{theorem}\label{Dual.isFaithfulPosMap_tfae}
   \uses{LinearMap.IsPosMap, Dual.IsFaithful}
   \lean{Module.Dual.isFaithfulPosMap_of_matrix_tfae}\leanok
   Given a linear functional $\phi\colon{M_n}\to\CC$, then the following are equivalent,
   \begin{enumerate}[label=(\roman*)]
    \item $\phi$ is positive and faithful,
    \item $\phi_Q$ is pos-def and $\forall{x}\in{M_n}:\phi(x)=\Tr(Qx)$,
    \item $M_n\times{M_n}\to\CC\colon(x,y)\mapsto\phi(x^*y)$ defines an inner product on $M_n$.
   \end{enumerate}
  \end{theorem}
  \begin{proof}\uses{dual_eq_trace, Dual.isReal_iff, Dual.isFaithfulPosMap_iff}\leanok
   The equivalence of the first and second parts is from Proposition \ref{Dual.isFaithfulPosMap_iff}.
   
   For any $x,y\in{M_n}$, let $\ip{x}{y}_\phi=\phi(x^*y)$.
   Then, clearly,
   \[\ip{x}{\alpha{y}+\beta{z}}_\phi=\phi(x^*(\alpha{y}+\beta{z}))=\alpha\phi(x^*y)+\beta\phi(x^*z)=\alpha\ip{x}{y}_\phi+\beta\ip{x}{z}_\phi,\]
   by linearity of $\phi$, for any $x,y,z\in{M_n}$ and $\alpha,\beta\in\CC$.
   
   If $\phi$ is faithful, we have $\ip{x}{x}_\phi=\phi(x^*x)=0$ if and only if $x=0$ for any $x\in{M_n}$.
   And $\phi$ is positive if and only if $0\leq\ip{x}{x}_\phi$ for any $x\in{M_n}$. So if $\ip{\cdot}{\cdot}_\phi$ defines an inner product on $M_n$, then we get $\phi$ is faithful and positive. So it remains to show that, given $\phi$ is a faithful and positive linear functional, we get $\overline{\ip{x}{y}_\phi}=\ip{y}{x}_\phi$ for any $x,y\in{M_n}$.
     
   Suppose $\phi$ is faithful and positive. By Proposition \ref{Dual.isFaithfulPosMap_iff}, we get the matrix $\phi_Q$ is positive definite (and so is self-adjoint). Using Proposition \ref{Dual.isReal_iff}, we get $\phi$ is real, and so, for any $x,y\in{M_n}$, we get, $\overline{\ip{x}{y}_\phi}=\overline{\phi(x^*y)}=\phi(y^*x)=\ip{y}{x}_\phi$.
   Therefore, $\ip{\cdot}{\cdot}_\phi\colon(x,y)\mapsto\phi(x^*y)$ is a well-defined inner product on $M_n$.
  \end{proof}

\section{On $\bigoplus_iM_{n_i}$}

\begin{definition}\label{PiMat.InnerProductSpace}
  \uses{Dual.isFaithfulPosMap_tfae, LinearMap.IsPosMap, Dual.IsFaithful}
  \lean{Module.Dual.pi.InnerProductSpace}\leanok
  For each $i$, we fix a faithful and positive linear functional $\psi_i$ on $M_{n_i}$, and we let $Q_i\in{M_{n_i}}$ denote the positive definite matrix such that $\psi_i\colon x\mapsto\Tr(Q_ix)$ (so each $Q_i=\sum_{j,k}\psi_i(e_{jk})e_{kj}$) -- see Proposition \ref{Dual.matrix}.

  Let $\psi$ be a faithful positive linear functional on $\bigoplus_iM_{n_i}$ given by $\psi=\sum_i\psi_i\circ p_i$, where each $p_i$ is the projection map $\bigoplus_jM_{n_j}\to M_{n_i}$, and we let $Q=\bigoplus_iQ_i$. So then, given $x\in\bigoplus_i{M_{n_i}}$, we get $\psi(x)=\Tr(Q x)$, where $\Tr$ here is defined by the sum of the diagonals in each matrix block.

  By Theorem \ref{Dual.isFaithfulPosMap_tfae}, we define the inner product on each $M_{n_i}$ by
  \[\ip{x}{y}_{\psi_i}=\psi_i(x^*y)=\Tr(Q_ix^*y),\]
  for all $x,y\in{M_{n_i}}$. We denote $(M_{n_i},\psi_i)$ to be the Hilbert space given by this inner product.\\
  We define the inner product on $\bigoplus_iM_{n_i}$ by \[\ip{x}{y}_{\psi}=\psi(x^*y)=\Tr(Q x^*y),\] for all $x,y\in\bigoplus_i{M_{n_i}}$, where $\Tr$ here is defined as the sum of the diagonals in each matrix block.
 \end{definition}

 \begin{proposition}\label{Dual.IsFaithfulPosMap.adjoint_eq_unit}
  \uses{PiMat.InnerProductSpace}
  \lean{Module.Dual.pi.IsFaithfulPosMap.adjoint_eq}\leanok
  The adjoint of $psi$ on $(\bigoplus_iM_{n_i},\psi)$ and $\CC$ is given by $\CC\to{B}\colon{x\mapsto{x1}}$. In other words, $\psi^*=\ket{1}$.
 \end{proposition}
 \begin{proof}\leanok
  For any $x\in\CC$ and $y\in\bigoplus_i{M_{n_i}}$, we have,
  \[\ip{\psi^*(x)}{y}_{\psi}=\ip{x}{\psi(y)}_\CC=\overline{x}\psi(y)=\overline{x}\ip{1}{y}_{\psi}=\ip{x1}{y}_{\psi}.\]
  Thus $\psi^*(x)=x1$ for any $x\in\CC$.
 \end{proof}

 \begin{proposition}\label{PiMat.onb}\uses{PiMat.InnerProductSpace}
  \lean{Module.Dual.pi.IsFaithfulPosMap.orthonormalBasis}\leanok
  We get $\left[\iota_s(e_{ij}Q_s^{-1/2})_{i,j=1}^{n_s}\right]_{s=1}^{\mathfrak{K}}$ is an orthonormal basis of $(\bigoplus_iM_{n_i},\psi)$.\\
  Here, $Q=\psi_Q$ from Proposition \ref{Dual.matrix}.
 \end{proposition}
 \begin{proof}
 \end{proof}

 Recall that, given an orthonormal basis $f=(f_i)$ on a Hilbert space $\Hcal$, we let $R_f$ be the linear isomorphism $\Hcal \cong \CC^{\dim\Hcal}$ given by $R_f(x)_i=\ip{f_i}{x}$.
 \begin{proposition}\label{PiMat.onb_repr}\uses{PiMat.onb}\lean{basis_repr_apply'}\leanok
  Let $f$ be the orthonormal basis from Proposition \ref{PiMat.onb}.
  Then for $x\in\bigoplus_iM_{n_i}$, we get $R_f(x)_{s,ij}=(xQ^{1/2})_{s,ij}$.\\
  Here, $Q=\psi_Q$ from Proposition \ref{Dual.matrix}.
 \end{proposition}
 \begin{proof}\uses{PiMat.InnerProductSpace}
 \end{proof}

\section{The modular automorphism}
 Let $B=\bigoplus_iM_{n_i}$ in this section.

 \begin{definition}\label{modAut}
  \uses{PiMat.InnerProductSpace}
  \lean{Module.Dual.pi.IsFaithfulPosMap.sig}\leanok
  Given $t\in\RR$, we define the algebra automorphism $\sigma_t\colon B\cong B$ to be given by $a\mapsto Q^{-t}aQ^{t}$ with inverse $a\mapsto Q^taQ^{-t}$ (so $\sigma_t^{-1}=\sigma_{-t}$).
 \end{definition}

 \begin{proposition}\label{modAut_real_apply}
  \uses{modAut, LinearMap.real}
  \lean{Module.Dual.pi.IsFaithfulPosMap.sig_star}\leanok
  For any $x\in B$, we get ${\sigma_{t}(x)}^*=\sigma_{-t}(x^*)$.\\
  In other words, $\sigma_t^{\operatorname{r}}=\sigma_{-t}$.
 \end{proposition}
 \begin{proof}\leanok
  We compute,
  \[{\sigma_{t}(x)}^*={Q^{-t}xQ^t}^*=Q^tx^*Q^{-t}=\sigma_{-t}(x^*).\]
 \end{proof}
 
 \begin{proposition}\label{modAut_isSelfAdjoint}
  \uses{modAut}
  \lean{Pi.PosDef.rpow.is_self_adjoint}\leanok
  For any $t\in\RR$, $\sigma_t$ is self-adjoint.
 \end{proposition}
 \begin{proof}\uses{modAut_real_apply, dual_eq_trace}\leanok
  Let $x,y\in{B}$. Then we compute
  \begin{align*}
   \ip{x}{\sigma_{t}^*(y)} &= \ip{\sigma_{t}(x)}{y}=\psi({\sigma_{t}(x)}^*y)=\psi(\sigma_{-t}(x^*)y) &\text{by \ref{modAut_real_apply}}\\
   &=\Tr(Q\sigma_{-t}(x^*)y)=\Tr(QQ^tx^*Q^{-t}y)\\
   &= \Tr(Q x^*Q^{-t}yQ^t)=\ip{x}{\sigma_{t}(y)}.
  \end{align*}
  Thus $\sigma_{t}$ is self-adjoint. Note that we used the fact $\psi\colon x\mapsto\Tr(Q x)$ (Proposition \ref{dual_eq_trace}).
 \end{proof}

 \begin{corollary}\label{modAut_isCoalgHom}\uses{modAut}
  \lean{Module.Dual.pi.IsFaithfulPosMap.sig_isCoalgHom}\leanok
  For any $t\in\RR$, we get $\sigma_t$ is also a co-algebra homomorphism.
 \end{corollary}
 \begin{proof}\uses{modAut_isSelfAdjoint, isAlgHom_iff_adjoint_isCoalgHom}
  \leanok
  Using Proposition \ref{isAlgHom_iff_adjoint_isCoalgHom}, it is enough to show that $\sigma_t^*$ is an algebra homomorphism. And this is true since $\sigma_t$ is self-adjoint by Proposition \ref{modAut_isSelfAdjoint}.
 \end{proof}
 
 \begin{lemma}\label{inner_star_left}
  \uses{PiMat.InnerProductSpace}
  \lean{Module.Dual.pi.IsFaithfulPosMap.inner_left_hMul}\leanok
  For any $x,y,z\in{B}$, we get $\ip{xy}{z}=\ip{y}{x^*z}$.
 \end{lemma}
 \begin{proof}\leanok
  Clearly, $\ip{xy}{z}=\psi(y^*x^*z)=\ip{y}{x^*z}$.
 \end{proof}

 \begin{lemma}\label{inner_conj_left}
  \uses{PiMat.InnerProductSpace}
  \lean{Module.Dual.pi.IsFaithfulPosMap.inner_right_conj'}\leanok
  For any $x,y,z\in{B}$, we get $\ip{xy}{z}=\ip{x}{z\sigma_{-1}(y^*)}$.
 \end{lemma}
 \begin{proof}\leanok
  \[\ip{xy}{z}=\Tr(Q{y^*x^*}z)=\Tr(Qx^*z(Qy^*Q^{-1}))=\ip{x}{z\sigma_{-1}(y^*)}.\]
 \end{proof}

 \begin{lemma}\label{modAut_zero}\uses{modAut}
  \lean{Module.Dual.pi.IsFaithfulPosMap.sig_zero'}\leanok
  We clearly get $\sigma_0=\id$.
 \end{lemma}
 \begin{proof}\leanok
  For any $x\in{B}$, we clearly get $\sigma_0(x)=Q^0xQ^0=x$.
 \end{proof}

 \begin{lemma}\label{modAut_comp}
  \uses{modAut}
  \lean{Module.Dual.pi.IsFaithfulPosMap.sig_apply_sig}\leanok
  For any $s,t\in\RR$, we get $\sigma_s\circ\sigma_t=\sigma_{s+t}$.
 \end{lemma}
 \begin{proof}\leanok
  For any $x\in{B}$, we get
  \[\sigma_s\sigma_t(x)=Q^{-s}(Q^{-t}xQ^t)Q^s=Q^{-(s+t)}xQ^{s+t}=\sigma_{s+t}(x).\]
 \end{proof}

 From Proposition \ref{FiniteDimensionalCoAlgebra_isFrobeniusAlgebra_of}, we see that our Hilbert space on $B$ is a Frobenius algebra.

\section{Multiplication composed with co-multiplication}

 \begin{proposition}\label{delta_form_iff}
  \uses{PiMat.InnerProductSpace}
  \lean{LinearMap.pi_mul'_comp_mul'_adjoint_eq_smul_id_iff}
  Given $\alpha\in\CC$, we get $mm^*=\alpha\id$ if and only if $\Tr(Q^{-1}_i)=\alpha$ for all $i\in[\mathfrak{K}]$.
 \end{proposition}
 \begin{proof}
 \end{proof}
